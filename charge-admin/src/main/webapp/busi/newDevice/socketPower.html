
<#include "/common/head.html"/>
<style>
    body{
        height: 500px;
    }
</style>
<div class="wrap_search">
    <!--<span class="search_item">-->
        <!--<span class="item_text">端口:</span>-->
        <!--<span class="item_obj">-->
            <!--<select  class="form-control" id="socket" name="socket">-->
							<!--<option  value='1'>1</option>-->
							<!--<option  value='2'>2</option>-->
                            <!--<option  value='3'>3</option>-->
                            <!--<option  value='4'>4</option>-->
                            <!--<option  value='5'>5</option>-->
                            <!--<option  value='6'>6</option>-->
                            <!--<option  value='7'>7</option>-->
                            <!--<option  value='8'>8</option>-->
                            <!--<option  value='9'>9</option>-->
                            <!--<option  value='10'>10</option>-->
                            <!--<option  value='11'>11</option>-->
                            <!--<option  value='12'>12</option>-->
                            <!--<option  value='13'>13</option>-->
                            <!--<option  value='14'>14</option>-->
                            <!--<option  value='15'>15</option>-->
                            <!--<option  value='16'>16</option>-->
                            <!--<option  value='17'>17</option>-->
                            <!--<option  value='18'>18</option>-->
                            <!--<option  value='19'>19</option>-->
                            <!--<option  value='20'>20</option>-->
						<!--</select>-->
		<!--</span>-->
    <!--</span>-->
    <span class="search_item search_between">
        <span class="item_text">时间: </span>
        <span class="item_obj">
            <input type="hidden" id="startDateVal">
             <input type="hidden" id="endDateVal">
            <input class="easyui-datetimebox"  name="startDate" id="startDate" value="" style="width: 140px"/> ：
            <input class="easyui-datetimebox"  name="endDate" id="endDate"  style="width: 140px" value=""/>
		</span>
    </span>
    <a href="javascript:void(0)" class="easyui-linkbutton color1" style="vertical-align: bottom;" iconCls="glyphicon-search" onclick="query(this)">搜索</a>
    <a href="javascript:void(0)" class="easyui-linkbutton color2" style="vertical-align: bottom;" iconCls="glyphicon-repeat" onclick="flushPage()">重置</a>
</div>
<div id="container" style="height: 100%"></div>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
<script type="text/javascript">
    var deviceId
    var option;
    var myChart
    $(function () {
        $("#startDate").datetimebox("setValue",getDateStr(1));
        $("#endDate").datetimebox("setValue",getDateStr(0));
        deviceId = GetQueryString('id');
        var dom = document.getElementById("container");
        myChart = echarts.init(dom);

        option = {
            tooltip: {
                confine:true,
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                formatter:function(params){
                    var text = "时间："+params[0].name+"<br />";
                    for (var i = 0; i < params.length; i++) {
                        if(params[i].value != "0"){
                            text +=params[i].marker+"插座 "+params[i].seriesName+" : "+params[i].value+"mA<br />";
                        }

                    }
                    return text;

                }
            },

            legend: {
                type: 'scroll',
                icon: "roundRect",
                right: 200,
                left:75,
                formatter: function (name) {
                    return "插座 " + name;
                },
                data:[]
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                feature: {
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    dataZoom: {
                        yAxisIndex: 'none'
                    },
                    restore: {},
                    saveAsImage: {}
                }
            },
            xAxis: {
                name:"时间",
                symbol:['none', 'arrow'],
                showMinLabel:true,
                showMaxLabel:true,
                type: 'category',
                boundaryGap: false,
                splitLine: {
                    show: false
                },
                axisLabel: {
                    formatter: function (value, index) {

                        // 格式化成月/日，只在第一个刻度显示年份
                        var date = new Date(value);
                        var y = date.getFullYear();
                        var m = date.getMonth()+1;//获取当前月份的日期
                        var d = date.getDate();
                        var hor = date.getHours();
                        var min = date.getMinutes();
                        var sec = date.getSeconds();

                        var texts = hor+":"+min+":"+sec;
                        if (index === 0) {
                            texts = y+"-"+m+"-"+d+" "+texts;
                        }
                        return texts;
                    },
                },

                // data: ['周一','周二','周三','周四','周五','周六','周日']
                data: []


            },
            yAxis: {
                name:"电流/mA",
                type: 'value'
            },
            dataZoom: [
                {
                    type: 'slider',
                    show: true,
                    xAxisIndex: [0],
                    start: 0,
                    end: 20,
                    top:"bottom",
                    textStyle:{
                        color:"#f07c29"
                    }
                },

                {
                    type: 'inside',
                    xAxisIndex: [0],
                    start: 0,
                    end: 100
                },

            ],

            series: []
        };



        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
        query();
    })


    function query() {
        myChart.showLoading();
        var data = {};
        var startDate = $("#startDate").datetimebox("getValue");
        var endDate = $("#endDate").datetimebox("getValue");
        // var socket = $("#socket").val();
        data = {
            id:deviceId,
            // socket:socket,
            startDate:startDate,
            endDate:endDate
        }


        $.ajax({
            type: 'post',
            url: "socketPowerDate",
            data: data,
            success: function (res) {
                myChart.hideLoading();
                var array =[];
                var legend =[];
                var electricityList = res.electricityList;
                var socketList = res.socketList;
                for (var i = 0; i < electricityList.length; i++) {
                    var   data = {
                        name:socketList[i],
                        type:'line',
                        data:electricityList[i],
                    }
                    array[i]=data
                }

                myChart.setOption({
                    xAxis: {
                        data:res.dateList
                    },
                    legend :{
                        data:socketList
                    },
                    // series: [{
                    //     data: res.electricityList
                    // }]

                    series:array

                });
            }
        });

    }

    function getDateStr(day) {
        var date = new Date();
        date.setDate(date.getDate()-day);//获取AddDayCount天后的日期
        var y = date.getFullYear();
        var m = date.getMonth()+1;//获取当前月份的日期
        var d = date.getDate();
        var hor = date.getHours();
        var min = date.getMinutes();
        var sec = date.getSeconds();
        return y+"-"+m+"-"+d+" "+hor+":"+min+":"+sec;
    }
    // 获取URL中的参数值
    function GetQueryString(url) {
        var reg = new RegExp("(^|&)" + url + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null)
            return unescape(r[2]);
        return null;
    }
</script>

<#include "/common/dialogWindow.html"/>
<#include "/common/foot.html"/>
