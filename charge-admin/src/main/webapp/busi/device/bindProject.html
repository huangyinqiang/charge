 <#include "/common/head.html"/>


<div class="easyui-panel updatePage"
	data-options="fit:true,border:false">
	<form id="ff" class="easyui-form" method="post">
		<table class="table1">
			<tr>
				<th><span>设备序号：</span></th>
				<td>
					<div class="wrap_input">
					<input type="hidden" name="id" value="${model.id!''}"">
						<input class="easyui-textbox" type="text" name="qr_num"
							id="QR_num" value="${model.qr_num!''}" data-options="fit: true" readonly="readonly"></input>
					</div>
				</td>
			<tr>
				<th><span>通讯序号：</span></th>
				<td>
					<div class="wrap_input">
						<input class="easyui-textbox" type="text" name="match_num"
							id="match_num" value="${model.match_num!''}"
							data-options="fit: true" readonly="readonly"></input>
					</div>
				</td>
			</tr>
			<tr>
				<th><span>设备位置：</span></th>
				<td>
					<div class="wrap_input">
						<input class="easyui-textbox" type="text" name="area" id="area"
							value="${model.area!''}" data-options="fit: true" readonly="readonly"></input>
					</div>
				</td>
			</tr>
			<tr>
				<th><span>已经绑定项目(为空则没有进行过绑定)：</span></th>
				<td>
				<div class="wrap_input">
					<input  class="easyui-textbox" type="text" id="bindProduct"  data-options="fit: true" readonly/>
				</div>
				</td>
			</tr>
			<tr>
				<th><span>绑定到：</span></th>
				<td>
				<div class="wrap_input">
					<input id="projectId" class="easyui-combotree" type="text" name="projectId"
                           data-options="fit: true,required:true" />
				</div>
				</td>
			</tr>
		</table>
	</form>
</div>
<script>
$(function() {
	//上级菜单
	$.post("${basePath}/device/queryProjectList", function(data) {
		var menulist = [];
		$.each(data, function(i, item) {
			menulist.push({
				id: item.id,
				text: item.name
			});
		});
		var treeData = [];
		for(var i = 0; i < menulist.length; i++) {
			treeData.push(menulist[i]);
		}
		$("#projectId").combotree({
			data: treeData,
			required: true,
		});

        $.post(
            "${basePath}/device/getBindProjectByDeviceId",
            "id="+${model.id},
            function(res) {
                if(res.data != null){
                    $("#bindProduct").textbox("setValue", res.data[0][2]);
                    var id = res.data[0][3];
                    $('#projectId').combotree('setValue',id);
                }

            }
        );
	});


});

top.window.subPage.save = save;
function save() {
	if($("#ff").form('validate')) {
		$.post("saveProject", getParam(), function(data) {
			top.window.closeWindow();
			top.window.subPage.loadCurrDatagrid();
		});
	}
}
function getParam() {
	var param = {
	   		"deviceId": ${model.id},
       	    "projectId": getInputValue("projectId"),
	}
	for(key in param) {
		if(!param[key]) {
			delete param[key];
		}
	}
	return param;
}

//扩展js
</script>
<#include "/common/foot.html"/>
