 <#include "/common/head.html"/>

<table id="dg"></table>

<div id="tb" style="padding: 2px 5px;">
	<div class="wrap_search">

		<input class="easyui-filebox" style="width:50%">

	</div>

</div>

<script type="text/javascript">
	var datagrid = $("#dg");
	var dgOptions = {
		rownumbers : true,
		fit : true,
		border : false,
		rownumbers : true,
		url : 'listData',
		method : 'post',
		toolbar : '#tb',
		pageSize : 50,
		pagination : true,
		multiSort : true,
		singleSelect : true,
		queryParams : getInitParam(),
        onLoadSuccess: onLoadSuccess,
		columns : [ [
				{
					field : 'id',
					checkbox : true
				},
				{
					field : 'status',
					title : '状态',
					width : 60,
					sortable : true,
					formatter : function(value, row, index) {
						if (value == '1') {
							return "<span style='color:green;font-size:20px;'>正常</span>";
						} else if (value == '2') {
							return "<span style='color:red;font-size:20px;'>离线</span>";
						} else {
							return "<span style='color:yellow;font-size:20px;'>故障</span>";
						}
					}
				},
				{
					field : 'sn',
					title : 'SN编号',
					width : 60,
				},
				{
					field : 'name',
					title : '名称',
					width : 60,
				},
				{
					field : 'province',
					title : '省',
					width : 60,
				},
            {
                field : 'city',
                title : '市',
                width : 60,
            },
            {
                field : 'detail_location',
                title : '详细位置信息',
                width : 120,
            },
            {
                field : 'lat',
                title : '经度',
                width : 60,
            },
            {
                field : 'lng',
                title : '纬度',
                width : 60,
            },
            {
                field : 'power_max',
                title : '最大功率',
                width : 60,
            },
            {
                field : 'socket_sum',
                title : '插座数量',
                width : 60,
            },
            {
                field : 'company_id',
                title : '公司id',
                width : 60,
            },
            {
                field : 'total_intensity',
                title : '总电流',
                width : 60,
            },
            {
                field : 'total_voltage',
                title : '总电压',
                width : 60,
            },
            {
                field : 'is_online',
                title : '是否上线',
                width : 60,
                formatter : function(value, row, index) {
                    if (value == '1') {
                        return "<span style='color:green;font-size:20px;'>启用</span>";
                    } else  {
                        return "<span style='color:red;font-size:20px;'>未上线</span>";
                    }
                }
			}, {
					field : 'online_date',
					title : '上线时间',
					width : 120,
					sortable : true
				},
            {
                field : 'update_time',
                title : '更新时间',
                width : 120,
                sortable : true
            },


            {
                field : 'chargeSocket_id',
                title : '插座序号',
                width : 60,
            },
            {
                field : 'chargeSocket_is_used',
                title : '占用',
                width : 60,
                formatter : function(value, row, index) {
                    if (value == '1') {
                        return "<span style='color:red;font-size:20px;'>是</span>";
                    } else  {
                        return "<span style='color:green;font-size:20px;'>否</span>";
                    }
                }
            },
            {
                field : 'chargeSocket_startPower',
                title : '开始电压',
                width : 60,
            },
            {
                field : 'chargeSocket_chargePower',
                title : '充电电压',
                width : 60,
            },
            {
                field : 'chargeSocket_chargeIntensity',
                title : '充电电流',
                width : 60,
            },
            {
                field : 'chargeSocket_chargeState',
                title : '充电状态',
                width : 60,
            },
            {
                field : 'chargeSocket_chargeTime',
                title : '充电时长',
                width : 60,
            },
			{
                field : 'chargeSocket_updateTime',
                title : '更新时间',
                width : 60,
			},




				] ]
	};
	$(function() {
		handleAuthDataRule();
		datagrid.datagrid(dgOptions);
	});

	function zcurdSearch() {
		var param = zcurdGetParam();
		datagrid.datagrid("load", {
			queryParams : param
		})
	}

	function zcurdGetParam() {
		var param = {};
		$("#tb :input[name]").each(function(i, item) {
			if ($(item).val()) {
				param[$(item).attr("name")] = $(item).val();
			}
		});
		return param;
	}

	function getInitParam() {
		var param = {};
		$("#tb :input[name]").each(
				function(i, item) {
					if ($(item).val()) {
						param["queryParams[" + $(item).attr("name") + "]"] = $(
								item).val();
					}
				});
		return param;
	}

	var initPara = zcurdGetParam();
	function add() {
		top.window.subPage.loadCurrDatagrid = function() {
			showMsg("增加设备成功");
			datagrid.datagrid("load");
		}
		top.openWindow("设备记录-增加", getCurrUrl("addPage") + "?"
				+ $.param(initPara), {
			size : '600x400'
		});
	}

	function update() {
		var rowsSel = datagrid.datagrid("getSelections");
		if (rowsSel.length != 1) {
			showWarnMsg("请选择要编辑的数据！");
			return;
		}
		var id = rowsSel[0].id;
		var type = rowsSel[0].type;
		top.window.subPage.loadCurrDatagrid = function() {
			showMsg("设置费率成功");
			datagrid.datagrid("reload");
		}
		if (type == "S") {
			top.openWindow("设备管理-设置费率-小功率", getCurrUrl("updatePage") + "?id="
					+ id, {
				size : '800x800'
			});
		} else {
			top.openWindow("设备管理-设置费率-大功率", getCurrUrl("updatePage1") + "?id="
					+ id, {
				size : '800x800'
			});
		}

	}
	function config() {
		top.window.subPage.loadCurrDatagrid = function() {
			showMsg("设置卡密码设置成功");
			datagrid.datagrid("reload");
		}
		top.openWindow("设备记录-设置卡密码", getCurrUrl("configPage"), {
			size : '600x400'
		});
	}
	function authorize() {
		var rowsSel = datagrid.datagrid("getSelections");
		if (rowsSel.length != 1) {
			showWarnMsg("请选择要编辑的数据！");
			return;
		}
		var id = rowsSel[0].id;
		top.window.subPage.loadCurrDatagrid = function() {
			showMsg("授权用户成功");
			datagrid.datagrid("reload");
		}
		top.openWindow("设备记录-授权用户", getCurrUrl("authorizePage") + "?id=" + id,
				{
					size : '600x600'
				});
	}
	function del() {
		var ids = [];
		$.each(datagrid.datagrid("getSelections"), function(i, item) {
			ids.push(item.id);
		});
		if (ids.length < 1) {
			showWarnMsg("请选择要删除的数据");
			return;
		}
		confirmMsg("确认删除?", function() {
			$.post("delete", {
				id : ids
			}, function(data) {
				showMsg("删除成功?");
				datagrid.datagrid("reload");
			});
		});
	}

	function status() {
		var rowsSel = datagrid.datagrid("getSelections");
		if (rowsSel.length != 1) {
			showWarnMsg("请选择择要查看的数据！");
			return;
		}
		var id = rowsSel[0].id;
		top.openWindow("设备状态-详情", getCurrUrl("statusPage") + "?id=" + id, {
			size : '600x700'
		});
	}
	function detail() {
		var rowsSel = datagrid.datagrid("getSelections");
		if (rowsSel.length != 1) {
			showWarnMsg("请选择择要查看的数据！");
			return;
		}
		var id = rowsSel[0].id;
		top.openWindow("设备记录-详情", getCurrUrl("detailPage") + "?id=" + id, {
			size : '600x400'
		});
	}
	function map() {
		top.openWindow("全城地图-详情", getCurrUrl("mapPage"), {
			size : '800x700'
		});
	}
	function exportCsv() {
		var option = datagrid.datagrid("options");
		var param = option.queryParams;
		param.sortName = option.sortName;
		param.sortOrder = option.sortOrder;
		window.location.href = "exportCsv?" + $.param(param);
	}

	//按钮事件

	/**
	 * 打开子页
	 */
	var _openSubPageFlag = false;
	function _openSubPage(pageUrl) {
		if (!_openSubPageFlag) {
			$("#subLayout").layout("expand", "east");
			setTimeout(function() {
				$("#subIframe").attr("src", pageUrl);
			}, 600);
			_openSubPageFlag = true;
		} else {
			$("#subIframe").attr("src", pageUrl);
		}
	}

	//扩展js
</script>

<#include "/common/dialogWindow.html"/> <#include "/common/foot.html"/>
