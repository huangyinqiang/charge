 <#include "/common/head.html"/>


<div class="easyui-panel updatePage"
	data-options="fit:true,border:false">
	<form id="ff" class="easyui-form" method="post">
		<input class="easyui-textbox" type="hidden" name="id"
			   id="id" value="${model.id!''}"/>
		<table class="table1">
			<tr>
				<th><span>用户名：</span></th>
				<td>
					<div class="wrap_input">
						<input class="easyui-textbox" type="text" name="user_name"
							id="user_name" value="${model.user_name!''}"
							data-options="fit: true,required:true"></input>
					</div>
				</td>

			</tr>
			<tr>
				<th><span>密码：</span></th>
				<td>
					<div class="wrap_input">
						<input class="easyui-textbox" type="text"
							name="password" id="password"
							value="${model.password!''}" data-options="fit: true"></input>
					</div>
				</td>

			</tr>

			<tr>
				<th><span>角色:</span></th>
				<td>
					<div class="wrap_input">
						<input id="roles" class="easyui-combobox" name="roles"
							   data-options="editable:false,multiple:true,"  style="width: 130px;"/>
					</div>
				</td>
			</tr>

		</table>
	</form>
</div>
<script>

/*    $('#roles').combobox({
        filter: function(q, row) {
            console.log(" q " + q)
            console.log(" row " + row)
            return row[opts.textField].indexOf(q) == 0;
        }
    })*/

    $(function(){
        var roles="${model.roles!''}";
        $('#roles').combobox({
            url:'getRoleList',
            valueField:'id',
            textField:'name',
            onLoadSuccess: function (data) {
                for (var i=0; i<data.length; i++) {
                    if (roles.indexOf(data[i].name)>=0) {
                        $('#roles').combobox('select',data[i].id);//选择后台查出来的第一个值
                    }
                }
            }
        })

    })

top.window.subPage.save = save;
function save() {
	if($("#zcurdHeadTable").form('validate')) {
		$.post("update", getParam(), function(data) {
			top.window.closeWindow();
			top.window.subPage.loadCurrDatagrid();
		});
	}
}
function getParam() {
    var roles ="";
    $("input[name='roles']").each(function(){
        roles+=$(this).val();
        roles+=",";
    });
    roles=roles.substr(0,roles.length-1);
	var param = {
        "model.id": $(":input[name='id']").val(),
        "model.user_name": $(":input[name='user_name']").val(),
        "model.password": $(":input[name='password']").val(),
        "model.roles": roles,
	}
	for(key in param) {
		if(!param[key]) {
			delete param[key];
		}
	}
	return param;
}

//扩展js
</script>
<#include "/common/foot.html"/>
