<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<meta name="format-detection" content="telphone=no,email=no" />
<meta name="keywords" content="">
<meta name="description" content="">
<title>我要充电</title>
<!--<link rel="stylesheet" type="text/css" href="temp/main.css">-->
<script type="text/javascript" src="temp/jquery.js"></script>
<script type="text/javascript" src="js/charging/startCharging.js"></script>
<script src="js/common/layer/layer.js"></script>
<link rel="stylesheet" href="js/common/layer/theme/default/layer.css">
<script type="text/javascript"
	src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <style>
        body,h1,h2,h3,h4,h5,h6{
            margin: 0;
        }
        a{
            text-decoration: none;
        }

        *{
            margin: 0;
            padding: 0;
        }
        ul,ol,dl,li,dt,dd{
            list-style: none;
        }

        /**/
        .ilogo{
            width: 100%;
            height: auto;
        }
        .logoImg{
            width: 1.95rem;
            height: 1rem;
            margin:0.2rem auto;
            background-image: url("images/ilogo.png");
            background-repeat: no-repeat;
            background-size: 100%;
        }

        /*我要充电*/
        .chargeBox{
            width:100%;
            height: 7rem;
            background: #00bcd4;
            position: relative;
        }
        .chargeImg{
            position: absolute;
            width: 4.27rem;
            height: 4.27rem;
            background: #00bcd4;
            top: 0.85rem;
            left: 0;
            right: 0;
            margin: auto;
        }
        .chargeImg img{
            width: 4.27rem;
            height: 4.27rem;
        }
        /*同意充电*/
        .argeeBOX{
            position: absolute;
            width: 3rem;
            left:0;right: 0;margin:auto;
            height: 0.5rem;
            top: calc(100% - 3.2rem);
        }
        .tick{
            position: absolute;
            left:0rem;
            width: 0.5rem;
            height: 0.5rem;
            background: #4acfe0;
        }
        .disclaimer{
            /*position: absolute;*/
            left: 0.65rem;
            font-size: 0.28rem;
            line-height: 0.5rem;
            color: white;
        }


        /*内容*/
        .bom_conntent{
            position: absolute;
            width: 92%;
            height: 4rem;
            background: white;
            left: 0;right: 0;top:calc(100% - -2.5rem);bottom: 0;
            margin: auto;
        }
        .bom_conntent ul{
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        .bom_conntent ul li{
            width: 50%;
            height: 50%;
            border: 1px solid #e5e5e5;
            box-sizing: border-box;
            float: left;
        }
        .bom_conntent ul>li:nth-child(1){
            border-bottom: none;
            border-right: none;
        }
        .bom_conntent ul>li:nth-child(2){
            border-bottom: none;
        }
        .bom_conntent ul>li:nth-child(3){
            border-right: none;
        }
        .conntent_list{
            width: 1rem;
            height:1.1rem;
            margin: 0 auto;
        }
        .conntent_list img{
            width: 0.8rem;
            height: 0.8rem;
        }
        .bom_conntent ul>li p{
            width: 100%;
            height: auto;
            font-size: 18px;
            text-align: center;
            color: #00bcd4;
            margin-top: 0.2rem;
        }
    </style>
<script type="text/javascript">

    (function (doc, win) {
        var docEl = doc.documentElement,
            resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
            recalc = function () {
                var clientWidth = docEl.clientWidth;
                if (!clientWidth) return;

//              750 代表设计稿的宽度,设计稿多宽,就改成多大
                if(clientWidth>=750){
                    docEl.style.fontSize = '100px';
                }else{
                    docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                }
            };

        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);

    var localUrl = window.location.href;
    var openId;
    $(function() {
        openId = localStorage.getItem("openId");// 获取名称为“key”的值
        if (null == openId) {
            getOpenId();
        }
        getJsSdk();
    });
    function getJsSdk() {
        $.ajax({
            type : "POST",
            url : "./scan/getJsSdk",
            data : {
                url : localUrl
            },
            cache : false,
            async : false,//
            dataType : "json",
            success : function(data) {
                wx.config({
                    debug : false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId : data.appId, // 必填，公众号的唯一标识
                    timestamp : data.timestamp, // 必填，生成签名的时间戳
                    nonceStr : data.nonceStr, // 必填，生成签名的随机串
                    signature : data.signature,// 必填，签名，见附录1
                    jsApiList : [ 'scanQRCode' ]
                    // 必填，需要使用的JS接口列表
                });
            }
        });
    }
    // 获取session中的openId
    function getOpenId() {
        $.ajax({
            type : "POST",
            url : "./getOpenId",
            cache : false,// *ie下面只会建立一次 ajax 请求，将响应结果放在浏览器缓存里 下次调用该ajax请求时
            // 从缓存里读取,为false只有ＧＥＴ请求生效
            async : false,// 设置同步方式，false为同步
            dataType : "json",
            success : function(data) {
                if (data.respObj != null && data.respCode == "000000") {
                    openId = data.respObj;
                    localStorage.setItem("openId", data.respObj);// 以“key”为名称存储一个值“value”
                } else {
                    location.href = ".?type=2";
                }
            }
        });
    }

    //扫码查询
    function scanQR() {
        if ($("input[type='checkbox']").is(':checked')) {
            wx.scanQRCode({
                needResult : 1,// 默认为0，扫描结果由微信处理，1则直接返回扫描结果
                desc : 'scanQRCode desc',
                success : function(res) {
                    // 扫码后获取结果参数赋值给Input
                    var deviceId = res.resultStr;
                    if(res.resultStr.indexOf("deviceid")>=0 && res.resultStr.indexOf("=")>=0 && res.resultStr.indexOf("?")>=0){

                        var strs = res.resultStr.split("=");
                        deviceId = strs[1];
                    }
                    if (deviceId.length == 11 || deviceId.length == 12) {
                        //新设备
                        queryNewDevice(deviceId);
                    }else {
                        //老设备
                        queryDevice(deviceId);
                    }


                }
            });
        } else {
            layer.msg("请查看并勾选‘同意《充电说明》’", {
                shift : 5
            });
            return;
        }
    }

    // 扫码查询
    function scanQR1() {
        queryDevice("1");

    }


    function queryNewDevice(value) {
        $.ajax({
            type : 'POST',
            url : "./newDevice/getDeviceInfo",
            dataType : "json",
            data : {
                deviceId : value
            },
            cache : false,
            async : false,
            success : function(data) {
                if (data.respCode != '000000' | null == data.respObj) {
                    layer.msg("设备暂时离线，请稍后再试...", {
                        shift : 5
                    });
                    return;
                }
                location.href = "./charging/chooseNewDevicePortAndTime?deviceId="
                    + data.respObj.id + "&area="
                    + encodeURI(encodeURI(data.respObj.province + data.respObj.city + data.respObj.detail_location)) + "&projectId="
                    + data.respObj.projectId + "&companyId=" + data.respObj.company_id

            },
            error : function() {

            }
        });

    }

    // 查询
    function queryDevice(value) {
        $.ajax({
            type : 'POST',
            url : "./device/queryDeviceInfoByQr",
            dataType : "json",
            data : {
                qr : value
            },
            cache : false,
            async : false,
            success : function(data) {
                if (data.respCode != '000000' | null == data.respObj) {
                    layer.msg("设备暂时离线，请稍后再试...", {
                        shift : 5
                    });
                    return;
                }
                location.href = "./charging/choosePortAndTime?deviceId="
                    + data.respObj.match_num + "&area="
                    + encodeURI(encodeURI(data.respObj.area)) + "&activityId="
                    + data.respObj.activity_id + "&type=" + data.respObj.type

            },
            error : function() {

            }
        });
    }


</script>
</head>
<body style="background: #f7f7f7;">
    <!-- logo -->
    <div class="ilogo">
        <div class="logoImg"></div>
    </div>


    <!-- 我要充电 -->
    <div class="chargeBox">
        <div class="chargeImg" onclick="scanQR()">
            <img src="images/charge.png">
        </div>

        <div class="argeeBOX">
            <input type="checkbox" checked="" style="zoom: 80%;">
            <a class="disclaimer" href="./about/mzsm">同意《充电说明》</a>
            <!--<div class="tick">-->
                <!--<img id="checkbox" src="images/tick.png"-->
                      <!--style="width: 0.6rem;height: 0.6rem;position: absolute;left: -0.02rem;right: 0;top: 0;bottom: 0;margin: auto;">-->
                <!---->
            <!--</div>-->

        </div>

        <!-- 底部跳转信息 -->
        <div class="bom_conntent">
            <ul>
                <li>
                    <a href="./about/mzsm">
                        <div class="conntent_list">
                            <img src="images/suoming.png" style="width:0.9rem;height: 0.9rem;">
                        </div>
                        <p>充电说明</p>
                    </a>
                </li>
                <li>
                    <a href="./about/warning">
                        <div class="conntent_list">
                            <img src="images/tishi.png">
                        </div>
                        <p>温馨提示</p>
                    </a>
                </li>
                <li>
                    <a href="./recharge">
                        <div class="conntent_list">
                            <img src="images/saoma.png">
                        </div>
                        <p>扫码优惠</p>
                    </a>
                </li>
                <li>
                    <a href="./">
                        <div class="conntent_list">
                            <img src="images/geren.png">
                        </div>
                        <p>个人中心</p>
                    </a>
                </li>
            </ul>
        </div>

    </div>
</body>
</html>

